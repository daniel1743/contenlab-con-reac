// Configuraci√≥n de Prisma con SQLite
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../database/creovision.db"
}

// ============================================
// MODELOS DE BASE DE DATOS
// ============================================

// üë§ Usuario
model User {
  id            String   @id @default(uuid())
  email         String   @unique
  passwordHash  String?
  fullName      String?
  avatarUrl     String?
  role          String   @default("user") // user, premium, admin

  // Timestamps
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relaciones
  profile       CreatorProfile?
  threads       Thread[]
  threadLikes   ThreadLike[]
  threadReplies ThreadReply[]
  content       Content[]
  credits       CreditTransaction[]

  @@map("users")
}

// üë®‚Äçüé® Perfil de Creador
model CreatorProfile {
  id              String   @id @default(uuid())
  userId          String   @unique
  displayName     String
  username        String   @unique
  bio             String?
  mission         String?
  vision          String?

  // Estad√≠sticas
  followers       Int      @default(0)
  engagement      Float    @default(0)
  totalViews      Int      @default(0)

  // Redes sociales
  twitterHandle   String?
  instagramHandle String?
  youtubeChannel  String?
  tiktokHandle    String?

  // Im√°genes (base64 en SQLite, URLs en producci√≥n)
  profileImage    String?
  coverImage      String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relaciones
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("creator_profiles")
}

// üßµ Hilo (Thread)
model Thread {
  id        String   @id @default(uuid())
  userId    String
  content   String
  gif       String?  // URL del GIF

  // M√©tricas
  likes     Int      @default(0)
  views     Int      @default(0)
  shares    Int      @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  threadLikes ThreadLike[]
  replies   ThreadReply[]

  @@map("threads")
}

// ‚ù§Ô∏è Like en Hilo
model ThreadLike {
  id        String   @id @default(uuid())
  threadId  String
  userId    String
  createdAt DateTime @default(now())

  thread    Thread   @relation(fields: [threadId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([threadId, userId])
  @@map("thread_likes")
}

// üí¨ Respuesta a Hilo
model ThreadReply {
  id        String   @id @default(uuid())
  threadId  String
  userId    String
  content   String   // M√°ximo 50 caracteres (validar en backend)
  userName  String

  createdAt DateTime @default(now())

  thread    Thread   @relation(fields: [threadId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("thread_replies")
}

// üé• Contenido (Videos/Posts)
model Content {
  id           String   @id @default(uuid())
  userId       String
  platform     String   // youtube, tiktok, instagram
  contentUrl   String?
  title        String
  displayOrder Int      @default(0)

  // M√©tricas
  likes        Int      @default(0)
  views        Int      @default(0)
  comments     Int      @default(0)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("content")
}

// üí∞ Sistema de Cr√©ditos
model CreditTransaction {
  id          String   @id @default(uuid())
  userId      String
  amount      Int      // Positivo = gan√≥, negativo = gast√≥
  type        String   // earned, spent, purchased, bonus
  description String

  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("credit_transactions")
}

// üìä An√°lisis de Tendencias (cach√©)
model TrendCache {
  id        String   @id @default(uuid())
  keyword   String   @unique
  platform  String   // youtube, tiktok, twitter, google
  data      String   // JSON stringificado

  createdAt DateTime @default(now())
  expiresAt DateTime

  @@map("trend_cache")
}
